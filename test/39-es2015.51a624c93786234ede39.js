(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{XC2f:function(e,t,i){"use strict";i.r(t),i.d(t,"UserAttendanceModule",(function(){return E}));var n=i("ofXK"),c=i("tyNb"),s=i("n+G7"),a=i("mrSG"),o=i("SP9e"),r=i("byUP"),l=i("fXoL"),d=i("4KEQ"),g=i("QeEr"),m=i("Sz29"),h=i("FnMX"),u=i("aCk2"),f=i("G0I0"),p=i("IvIE"),v=i("V/o5"),b=i("3Pt+"),j=i("NFeN");function T(e,t){if(1&e&&(l.jc(0,"option",11),l.Wc(1),l.ic()),2&e){const e=t.$implicit;l.Bc("value",e.userId),l.Pb(1),l.Xc(e.name)}}function y(e,t){if(1&e){const e=l.kc();l.jc(0,"div",8),l.jc(1,"select",9),l.rc("change",(function(t){l.Mc(e);const i=l.vc();return i.loadAttendance(t.target.value),i.loadMonthlyAttendance(t.target.value)})),l.jc(2,"option"),l.Wc(3,"Select User"),l.ic(),l.Vc(4,T,2,2,"option",10),l.ic(),l.ic()}if(2&e){const e=l.vc();l.Pb(4),l.Bc("ngForOf",e.users)}}function M(e,t){if(1&e&&(l.jc(0,"tr"),l.jc(1,"td"),l.Wc(2),l.ic(),l.jc(3,"td"),l.Wc(4),l.ic(),l.jc(5,"td",17),l.Wc(6),l.ic(),l.ic()),2&e){const e=t.$implicit,i=l.vc(2);l.Pb(2),l.Xc(e.date),l.Pb(2),l.Xc(i.getFirstAndLastEntries(e.datetime)),l.Pb(2),l.Xc(i.getMinutesSpent(e.date,e.datetime))}}function P(e,t){if(1&e){const e=l.kc();l.jc(0,"div",12),l.jc(1,"div",13),l.Wc(2,"Monthly Attendance "),l.jc(3,"div",14),l.jc(4,"mat-icon",15),l.rc("click",(function(){return l.Mc(e),l.vc().changeDate("prev")})),l.Wc(5,"navigate_before"),l.ic(),l.jc(6,"mat-icon",15),l.rc("click",(function(){return l.Mc(e),l.vc().changeDate("next")})),l.Wc(7,"navigate_next"),l.ic(),l.ic(),l.ic(),l.jc(8,"table",16),l.jc(9,"tr"),l.jc(10,"th"),l.Wc(11,"Date"),l.ic(),l.jc(12,"th"),l.Wc(13,"Entries"),l.ic(),l.jc(14,"th",17),l.Wc(15,"Minutes Spend"),l.ic(),l.ic(),l.Vc(16,M,7,3,"tr",18),l.ic(),l.ic()}if(2&e){const e=l.vc();l.Pb(16),l.Bc("ngForOf",e.monthlyAttendance)}}let w=(()=>{class e{constructor(e,t,i,n){this.coreService=e,this.dialog=t,this.dateTimeService=i,this.usersService=n,this.loading=!0,this.users=[],this.events=[],this.monthlyAttendance=[],this.masterMonthlyAttendance=[],this.monthlyDate=new Date,this.calendarOptions={initialView:"dayGridMonth",headerToolbar:{left:"prev,next",right:"dayGridMonth,timeGridWeek,timeGridDay"},footerToolbar:{center:"title"},eventClick:this.handleDateClick.bind(this),events:this.events},this.permissions=r.a}ngOnInit(){return Object(a.a)(this,void 0,void 0,(function*(){this.getAttendance(),this.getUsers(),this.permissions=yield this.usersService.getUserPermissions()}))}getUsers(){this.coreService.getRequest(o.a.API_URL+"users").subscribe(e=>{this.users=e})}loadAttendance(e){this.loading=!0,this.coreService.getRequest(o.a.API_URL+`users/${e}/attendance`).subscribe(e=>{const t={},i=e.from_to_time;e.entries.forEach(e=>{const i=new Date(e.datetime),n=""+i.getDate()+(i.getMonth()+1)+i.getFullYear();n in t?t[n].push(e.datetime):t[n]=[e.datetime]}),this.events.length=0,this.insertEvents(t,i),this.loading=!1})}loadMonthlyAttendance(e){this.loading=!0,this.coreService.getRequest(o.a.API_URL+`users/${e}/monthly-attendance`).subscribe(e=>{this.monthlyAttendance=e,this.masterMonthlyAttendance=[...e],this.filterMonthlyAttendance(),this.loading=!1})}getFirstAndLastEntries(e){if(e){let t=e.split(",");return t[0]+" - "+t[t.length-1]}}getMinutesSpent(e,t){let i=t.split(","),n=new Date(e+" "+i[0].substr(0,5));return(new Date(e+" "+i[i.length-1].substr(0,5)).getTime()-n.getTime())/1e3/60}changeDate(e){let t=0;t="next"==e?this.monthlyDate.getMonth()+1:this.monthlyDate.getMonth()-1,this.monthlyDate.setMonth(t),this.filterMonthlyAttendance()}filterMonthlyAttendance(){this.monthlyAttendance=this.masterMonthlyAttendance.filter(e=>this.dateTimeService.getFormattedDate(e.date).slice(3)==this.dateTimeService.getFormattedDate(this.monthlyDate).slice(3))}handleDateClick(e){const t=this.dateTimeService.getFormattedDate(e.event.start);this.dialog.showDialog({content:e.event.extendedProps.message,title:t+" Details"})}getAttendance(){this.coreService.getRequest(o.a.API_URL+"users/attendance").subscribe(e=>{const t={},i=e.from_to_time;e.entries.forEach(e=>{const i=new Date(e.datetime),n=""+i.getDate()+(i.getMonth()+1)+i.getFullYear();n in t?t[n].push(e.datetime):t[n]=[e.datetime]}),this.insertEvents(t,i)}),this.loading=!1}insertEvents(e,t){for(let i in e){let n=this.getHourAndMinutes(e[i]);const c=this.getColor(e[i][0],t);this.events.push({title:"Entry",date:e[i][0],end:e[i][e[i].length-1],message:n,backgroundColor:c})}}getHourAndMinutes(e){let t="";for(let s of e){let e=new Date(s);var i=e.getHours(),n=e.getMinutes().toString().padStart(2,"0"),c=i>=12?"PM":"AM";t+=(i%=12).toString().padStart(2,"0")+":"+n+" "+c+"<br>"}return t}getColor(e,t){if(!t)return"black";const i=t.fromTime;let n=new Date(e),c=new Date(e);c.setHours(i.split(":")[0]),c.setMinutes(i.split(":")[1]),c.setSeconds(i.split(":")[2]);let s=(n.getTime()-c.getTime())/1e3;return s<=0?"green":s<=300?"orange":"red"}}return e.\u0275fac=function(t){return new(t||e)(l.dc(d.a),l.dc(g.a),l.dc(m.a),l.dc(h.a))},e.\u0275cmp=l.Xb({type:e,selectors:[["app-user-attendance"]],decls:10,vars:5,consts:[["id","page-content"],["class","row attendance-row",4,"ngIf"],[1,"row"],["id","full-calendar",1,"col-sm-6","pr"],[3,"deepChangeDetection","options"],["mycal",""],["class","col-sm-6 pl",4,"ngIf"],[3,"show"],[1,"row","attendance-row"],[1,"select",3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-sm-6","pl"],[1,"content-title","row","justify-content-between"],[1,"monthly-attendance-nav"],[3,"click"],[1,"pinnacle-table"],[1,"minutes"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(l.ec(0,"admin-header"),l.ec(1,"admin-sidebar"),l.jc(2,"div",0),l.Vc(3,y,5,1,"div",1),l.jc(4,"div",2),l.jc(5,"div",3),l.ec(6,"full-calendar",4,5),l.ic(),l.Vc(8,P,17,1,"div",6),l.ic(),l.ic(),l.ec(9,"loading",7)),2&e&&(l.Pb(3),l.Bc("ngIf",t.permissions.see_others_attendance),l.Pb(3),l.Bc("deepChangeDetection",!0)("options",t.calendarOptions),l.Pb(2),l.Bc("ngIf",t.permissions.see_others_attendance),l.Pb(1),l.Bc("show",t.loading))},directives:[u.a,f.a,n.k,p.a,v.a,b.o,b.u,n.j,j.a],styles:[".attendance-row[_ngcontent-%COMP%]{padding-bottom:15px}.select[_ngcontent-%COMP%]{width:200px}#full-calendar[_ngcontent-%COMP%]{max-width:650px;background:#fff;padding:15px}.minutes[_ngcontent-%COMP%]{text-align:right}"]}),e})();const D=function(e){return{backgroundColor:e,color:"#fff"}};function F(e,t){if(1&e&&(l.jc(0,"div",5),l.Wc(1),l.ic()),2&e){const e=t.$implicit,i=t.index,n=l.vc().$implicit,c=l.vc();l.Bc("ngStyle",l.Dc(2,D,c.getEntryColor(e.entry,n.from_to_time,i,n.entries.length))),l.Pb(1),l.Xc(e.entry)}}function S(e,t){if(1&e&&(l.jc(0,"tr"),l.jc(1,"td"),l.Wc(2),l.ic(),l.jc(3,"td"),l.Vc(4,F,2,4,"div",4),l.ic(),l.ic()),2&e){const e=t.$implicit;l.Pb(2),l.Xc(e.name),l.Pb(2),l.Bc("ngForOf",e.entries)}}let W=(()=>{class e{constructor(e,t){this.coreService=e,this.dateTimeService=t,this.loading=!0,this.attendance=[]}ngOnInit(){this.getTodaysAttendance()}getTodaysAttendance(){this.coreService.getRequest(o.a.API_URL+"users/attendance/today").subscribe(e=>{this.attendance=e,this.loading=!1})}getEntryColor(e,t,i,n){if(!t)return"black";const c=new Date(this.dateTimeService.getFormattedDate(new Date)+" "+e);let s=0;if(0==i){const e=new Date(this.dateTimeService.getFormattedDate(new Date)+" "+t.fromTime);s=(c.getTime()-e.getTime())/1e3}else{if(i!=n-1)return"#888";s=(new Date(this.dateTimeService.getFormattedDate(new Date)+" "+t.toTime).getTime()-c.getTime())/1e3}return s<=0?"green":s<=300?"orange":"red"}}return e.\u0275fac=function(t){return new(t||e)(l.dc(d.a),l.dc(m.a))},e.\u0275cmp=l.Xb({type:e,selectors:[["app-user-attendance-today"]],decls:11,vars:2,consts:[["id","page-content"],[1,"pinnacle-table","big-heading"],[4,"ngFor","ngForOf"],[3,"show"],["class","assigned-items",3,"ngStyle",4,"ngFor","ngForOf"],[1,"assigned-items",3,"ngStyle"]],template:function(e,t){1&e&&(l.ec(0,"admin-header"),l.ec(1,"admin-sidebar"),l.jc(2,"div",0),l.jc(3,"table",1),l.jc(4,"tr"),l.jc(5,"th"),l.Wc(6,"User Name"),l.ic(),l.jc(7,"th"),l.Wc(8,"Entries"),l.ic(),l.ic(),l.Vc(9,S,5,2,"tr",2),l.ic(),l.ic(),l.ec(10,"loading",3)),2&e&&(l.Pb(9),l.Bc("ngForOf",t.attendance),l.Pb(1),l.Bc("show",t.loading))},directives:[u.a,f.a,n.j,v.a,n.l],styles:["td[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;padding:2px 10px;border-radius:4px;box-shadow:0 0 2px rgba(0,0,0,.25);margin-right:10px}"]}),e})();var A=i("kmnG"),C=i("d3UM"),k=i("bTqV"),x=i("FKr1");function B(e,t){if(1&e&&(l.jc(0,"mat-option",16),l.Wc(1),l.ic()),2&e){const e=t.$implicit;l.Bc("value",e.userId),l.Pb(1),l.Xc(e.name)}}function _(e,t){if(1&e&&(l.jc(0,"mat-option",16),l.Wc(1),l.ic()),2&e){const e=t.$implicit;l.Bc("value",e),l.Pb(1),l.Xc(e)}}function O(e,t){if(1&e&&(l.jc(0,"mat-option",16),l.Wc(1),l.ic()),2&e){const e=t.$implicit;l.Bc("value",e),l.Pb(1),l.Xc(e)}}function I(e,t){if(1&e&&(l.jc(0,"tr"),l.jc(1,"td"),l.Wc(2),l.ic(),l.jc(3,"td"),l.Wc(4),l.ic(),l.jc(5,"td"),l.Wc(6),l.ic(),l.ic()),2&e){const e=t.$implicit;l.Pb(2),l.Xc(e.name),l.Pb(2),l.Xc(e.fromTime),l.Pb(2),l.Xc(e.toTime)}}let L=(()=>{class e{constructor(e,t){this.coreService=e,this.dialog=t,this.loading=!0,this.users=[],this.timings=[],this.timeSlots=[],this.timingForm={userId:null,fromTime:null,toTime:null}}ngOnInit(){this.getUsers(),this.getTimings(),this.setTimeSlots()}getUsers(){this.coreService.getRequest(o.a.API_URL+"users").subscribe(e=>{this.users=e,this.loading=!1})}getTimings(){this.loading=!0,this.coreService.getRequest(o.a.API_URL+"users/timings").subscribe(e=>{this.timings=e,this.loading=!1})}populateTimings(){const e=this.timingForm.userId;let t=this.timings.find(t=>t.userId==e);if(t){const e=t.fromTime.slice(0,5),i=t.toTime.slice(0,5);this.timingForm.fromTime=e,this.timingForm.toTime=i}}setTimeSlots(){for(let e=8;e<=20;e++)for(let t=0;t<=45;t+=15){let i=(e+"").padStart(2,"0"),n=(t+"").padStart(2,"0");this.timeSlots.push(`${i}:${n}`)}}submitTimings(){this.loading=!0,this.coreService.putRequest(o.a.API_URL+"users/timings",this.timingForm).subscribe(e=>{this.loading=!1,this.dialog.showDialog({content:e.message})})}}return e.\u0275fac=function(t){return new(t||e)(l.dc(d.a),l.dc(g.a))},e.\u0275cmp=l.Xb({type:e,selectors:[["app-set-timings"]],decls:42,vars:8,consts:[["id","page-content"],[1,"content-title"],[1,"content-box"],["timingsForm","ngForm"],[1,"row"],[1,"col-sm-12"],["name","userId","required","",3,"ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-6"],["name","fromTime",3,"ngModel","ngModelChange"],["name","toTime",3,"ngModel","ngModelChange"],["mat-raised-button","","color","primary",3,"click"],[2,"height","15px"],[1,"pinnacle-table"],[4,"ngFor","ngForOf"],[3,"show"],[3,"value"]],template:function(e,t){1&e&&(l.ec(0,"admin-header"),l.ec(1,"admin-sidebar"),l.jc(2,"div",0),l.jc(3,"div",1),l.Wc(4,"Set Timings"),l.ic(),l.jc(5,"div",2),l.jc(6,"form",null,3),l.jc(8,"div",4),l.jc(9,"div",5),l.jc(10,"mat-form-field"),l.jc(11,"mat-label"),l.Wc(12,"Select User"),l.ic(),l.jc(13,"mat-select",6),l.rc("selectionChange",(function(){return t.populateTimings()}))("ngModelChange",(function(e){return t.timingForm.userId=e})),l.Vc(14,B,2,2,"mat-option",7),l.ic(),l.ic(),l.ic(),l.jc(15,"div",8),l.jc(16,"mat-form-field"),l.jc(17,"mat-label"),l.Wc(18,"From Time"),l.ic(),l.jc(19,"mat-select",9),l.rc("ngModelChange",(function(e){return t.timingForm.fromTime=e})),l.Vc(20,_,2,2,"mat-option",7),l.ic(),l.ic(),l.ic(),l.jc(21,"div",8),l.jc(22,"mat-form-field"),l.jc(23,"mat-label"),l.Wc(24,"To Time"),l.ic(),l.jc(25,"mat-select",10),l.rc("ngModelChange",(function(e){return t.timingForm.toTime=e})),l.Vc(26,O,2,2,"mat-option",7),l.ic(),l.ic(),l.ic(),l.ic(),l.jc(27,"button",11),l.rc("click",(function(){return t.submitTimings()})),l.Wc(28,"Submit"),l.ic(),l.ic(),l.ic(),l.ec(29,"div",12),l.jc(30,"div",1),l.Wc(31,"Active Timings"),l.ic(),l.jc(32,"table",13),l.jc(33,"tr"),l.jc(34,"th"),l.Wc(35,"Name"),l.ic(),l.jc(36,"th"),l.Wc(37,"From"),l.ic(),l.jc(38,"th"),l.Wc(39,"To"),l.ic(),l.ic(),l.Vc(40,I,7,3,"tr",14),l.ic(),l.ic(),l.ec(41,"loading",15)),2&e&&(l.Pb(13),l.Bc("ngModel",t.timingForm.userId),l.Pb(1),l.Bc("ngForOf",t.users),l.Pb(5),l.Bc("ngModel",t.timingForm.fromTime),l.Pb(1),l.Bc("ngForOf",t.timeSlots),l.Pb(5),l.Bc("ngModel",t.timingForm.toTime),l.Pb(1),l.Bc("ngForOf",t.timeSlots),l.Pb(14),l.Bc("ngForOf",t.timings),l.Pb(1),l.Bc("show",t.loading))},directives:[u.a,f.a,b.v,b.l,b.m,A.b,A.e,C.a,b.r,b.k,b.n,n.j,k.b,v.a,x.h],styles:["[class*=col-][_ngcontent-%COMP%]{padding:5px}"]}),e})();var U=i("z17N");function X(e,t){if(1&e&&(l.jc(0,"tr"),l.ec(1,"td",12),l.ec(2,"td",12),l.ec(3,"td",12),l.ec(4,"td",12),l.ec(5,"td",12),l.ic()),2&e){const e=t.$implicit;l.Pb(1),l.Bc("innerText",e.name),l.Pb(1),l.Bc("innerText",3),l.Pb(1),l.Bc("innerText",e.takenLeaves),l.Pb(1),l.Bc("innerText",e.untoldLeaves),l.Pb(1),l.Bc("innerText",e.moreLeavesThanAllowed+2*e.untoldLeaves)}}const R=[{path:"",component:w},{path:"today",component:W},{path:"set-timings",component:L},{path:"users-leaves",component:(()=>{class e{constructor(e){this.coreService=e,this.loading=!0,this.usersLeaves=[],this.date=new Date}ngOnInit(){this.date.setDate(1),this.filterLeaves()}getUsersLeaves(e,t){this.coreService.getRequest(o.a.API_URL+"leaves/all-users-leaves?month="+e+"&year="+t).subscribe(e=>{this.usersLeaves=e,this.loading=!1})}changeDate(e){let t=new Date(this.date);"next"==e?(t.setMonth(t.getMonth()+1),this.date=t):(t.setMonth(t.getMonth()-1),this.date=t),this.filterLeaves()}filterLeaves(){this.getUsersLeaves(this.date.getMonth(),this.date.getFullYear())}}return e.\u0275fac=function(t){return new(t||e)(l.dc(d.a))},e.\u0275cmp=l.Xb({type:e,selectors:[["app-users-leaves"]],decls:29,vars:6,consts:[["id","page-content"],[1,"content-title","row","justify-content-between","align-items-center"],[1,"input-field-date"],["id","date-prev",3,"click"],["name","inquiryDate","ngModel","","placeholder","Schedule Date","required","",1,"input-field",3,"ngModel","owlDateTime","owlDateTimeTrigger","dateTimeChange","ngModelChange"],["id","date-next",3,"click"],["matSuffix","",1,"material-icons"],[3,"pickerType"],["dt1",""],[1,"pinnacle-table"],[4,"ngFor","ngForOf"],[3,"show"],[3,"innerText"]],template:function(e,t){if(1&e&&(l.ec(0,"admin-header"),l.ec(1,"admin-sidebar"),l.jc(2,"div",0),l.jc(3,"div",1),l.Wc(4,"Users Leaves "),l.jc(5,"div",2),l.jc(6,"mat-icon",3),l.rc("click",(function(){return t.changeDate("prev")})),l.Wc(7,"navigate_before"),l.ic(),l.jc(8,"input",4),l.rc("dateTimeChange",(function(){return t.filterLeaves()}))("ngModelChange",(function(e){return t.date=e})),l.ic(),l.jc(9,"mat-icon",5),l.rc("click",(function(){return t.changeDate("next")})),l.Wc(10,"navigate_next"),l.ic(),l.jc(11,"span",6),l.Wc(12,"calendar_today"),l.ic(),l.ec(13,"owl-date-time",7,8),l.ic(),l.ic(),l.jc(15,"table",9),l.jc(16,"tr"),l.jc(17,"th"),l.Wc(18,"Name"),l.ic(),l.jc(19,"th"),l.Wc(20,"Allowed Leaves"),l.ic(),l.jc(21,"th"),l.Wc(22,"Taken Leaves"),l.ic(),l.jc(23,"th"),l.Wc(24,"Untold Leaves"),l.ic(),l.jc(25,"th"),l.Wc(26,"Days to Deduct"),l.ic(),l.ic(),l.Vc(27,X,6,5,"tr",10),l.ic(),l.ic(),l.ec(28,"loading",11)),2&e){const e=l.Ic(14);l.Pb(8),l.Bc("ngModel",t.date)("owlDateTime",e)("owlDateTimeTrigger",e),l.Pb(5),l.Bc("pickerType","calendar"),l.Pb(14),l.Bc("ngForOf",t.usersLeaves),l.Pb(1),l.Bc("show",t.loading)}},directives:[u.a,f.a,j.a,b.b,U.b,b.k,b.n,b.r,U.d,A.f,U.a,n.j,v.a],styles:[""]}),e})()}];let E=(()=>{class e{}return e.\u0275mod=l.bc({type:e}),e.\u0275inj=l.ac({factory:function(t){return new(t||e)},imports:[[n.c,s.a,c.f.forChild(R)]]}),e})()}}]);